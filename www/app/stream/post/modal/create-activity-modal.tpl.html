<!--NOTE: The scope of controller is generated by stream-ctrl.js-->

<div class="modal create-activity-modal" ng-controller="ActivityBarCtrl">
  <ion-header-bar>
    <button class="button button-icon icon ion-chevron-left" ng-click="cancel()"></button>
    <h1 class="title">TRACK ACTIVITY</h1>
    <button class="post active" ng-show="activtyQueue && activtyQueue.length > 0" ng-click="saveActivities()" ng-disabled="savingActivities">Save</button>
    <div ng-show="errorMessage.length > 0" style="color:red">{{errorMessage}}</div>
  </ion-header-bar>
  <ion-content class="padding has-header add-activity-post">
    <div class="row create-post">
      <form>
        <textarea ng-model="newPost.text" class="post-box"></textarea>
      </form>
    </div>

    <div class="activity-select">
      <div class="row">
        <div class="col">
          <h3 class="activity-title" ng-click="backtrackBreadcrumb()"><span class="icon ion-chevron-left" ng-hide="currentState == 0"></span> {{ title }}</h3>
        </div>
      </div>

      <ion-scroll>
        <div class="row" ng-repeat="row in activityData | inSlicesOf:2" ng-show="activityListVisible">
          <div class="col col-50 activity-item-container" ng-repeat="item in row">
            <div class="activity-item" ng-click="onItemSelect(item)">{{item[nameKey]}}</div>
          </div>
        </div>
      </ion-scroll>
      <form name="activityForm" ng-show="showActivityForm" >
        <div class="row" >
          <div class="col col-50">
            <label class="item item-input item-stacked-label">
              <span class="input-label">Activity</span>
              <input type="text" class="ellipsis" ng-model="currentActivity.activityName" readonly required/>
            </label>
          </div>

          <div class="col col-50">
            <label class="item item-input item-stacked-label">
              <span class="input-label">Date</span>
              <input type="date" name="date" ng-model="currentActivity.date" max="{{maxDate}}" required placeholder="yyyy-MM-dd" style="padding-left: 0px"/>
              <span class="input-label"  style="color:red" ng-show="activityForm.date.$error.required">Date Required!</span>
            </label>
          </div>
        </div>

        <div class="row" >
          <div class="col">
            <label class="item item-input item-stacked-label">
              <span class="input-label">Quantity ({{currentActivity.unitName}})</span>
              <input type="number" name="quantity" placeholder="{{currentActivity.unitName}}" ng-model="currentActivity.quantity" required min="1" readonly style="text-align: center" ng-click="showNumpad = !showNumpad"/>
                <numpad ng-show="showNumpad" model="currentActivity.quantity" accept="alert()"></numpad>
                <span class="input-label"  style="color:red" ng-show="activityForm.quantity.$error.required">Number Required!</span>
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col" style="text-align: right">
            <span style="color:red">{{errorMessage}}</span>
            <button class="button button-balanced" ng-click="addActivity()" ng-disabled="!activityForm.$valid || savingActivity">Add</button>
            <button class="button button-assertive" ng-click="clearActivity()">Clear</button>
          </div>
        </div>
      </form>

      <div class="row">
        <div class="col">
          <h3 class="activity-title">Activity Queue</h3>
        </div>
      </div>
      <div class="row" ng-show="!activtyQueue || activtyQueue.length === 0">
        <div class="col" style="color">
          No Activites Selected
        </div>
      </div>
      <ion-list  show-delete="true" >
        <ion-item ng-repeat="activity in activtyQueue" class="item-thumbnail-left activity-queue-item" ng-click="restoreActivity(activity)">
          You tracked {{activity.quantity}} {{activity.unitName}} of {{activity.activityName}}
          <ion-delete-button class="ion-minus-circled" ng-click="activtyQueue.splice($index, 1)">
        </ion-item>
      </ion-list>

    </div>
  </ion-content>
</div>
