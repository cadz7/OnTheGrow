<!-- ion-nav-bar goes here -->
<ion-view title="Streams">
  <!-- ion-header-bar -->
   <ion-header-bar align-title="center" class="bar">
    <left-nav-toggle-btn></left-nav-toggle-btn>
    <h1 class="title" ng-click="showFilterOptions()">
      {{filterByType}}
    </h1>
    <span class="icon ion-chevron-down filter-chevron"></span>
    <!-- only show if user is logged in -->
    <!-- ng-show="AuthSvc.isLoggedIn()" -->
    <!-- Settings Button -->

    <div class="buttons">
      <button class="button button-clear icon sprout-icon-notification"></button>
    </div>
    

  </ion-header-bar>

	<!-- <ion-content header-shrink scroll-event-interval="5" id="sproutPostsScroller" style="top: 165px;" -->
  <ion-content id="sproutPostsScroller"
    ng-class="{true: 'no-header', false: 'has-header'}[createPostVisible]">

      <ion-refresher on-refresh="onRefreshPullDown()"
        pulling-text="Pull to refresh..."
        refreshing-text="Refreshing!"
        refreshing-icon="ion-loading-c">
                  
      </ion-refresher>


    <div class="add-activity-post" ng-controller="ActivityBarCtrl"
        ng-class="{'activity-select-visible': addActivityVisible}">

      <div class="row create-post">
        <form>
          <textarea ng-model="newPost.text" class="post-box"></textarea>
          <div class="row">
            <div class="col">
              <span class="icon ion-edit"></span>
              <a ng-click="submitPost(newPost)" href="javascript:void(0)">Post To Stream</a>
            </div>
            <div class="col">
              <span class="icon ion-android-stopwatch"></span>
              <a ng-click="onTrackActivityClick()" href="javascript:void(0)">Track Activity</a>
            </div>
          </div>
        </form>
      </div>

      <div class="activity-select" ng-show="addActivityVisible">
        <div class="row">
          <div class="col">
            <h3 class="activity-title">{{ title }}</h3>
          </div>
        </div>

        <ion-scroll>
          <div class="row" ng-repeat="row in activityData | inSlicesOf:2" ng-show="activityListVisible">
            <div class="col col-50 activity-item-container" ng-repeat="item in row">
              <div class="activity-item" ng-click="onItemSelect(item)">{{item[nameKey]}}</div>
            </div>
          </div>
        </ion-scroll>
        <form name="activityForm" ng-show="showActivityForm" >
          <div class="row" >
            <div class="col col-50">
              <label class="item item-input item-stacked-label">
                <span class="input-label">Activity</span>
                <input type="text" ng-model="currentActivity.activityName" readonly required/>
              </label>
            </div>

            <div class="col col-50">
              <label class="item item-input item-stacked-label">
                <span class="input-label">Date</span>
                <input type="date" name="date" ng-model="currentActivity.date" max="{{maxDate}}" required placeholder="yyyy-MM-dd" style="padding-left: 0px"/>
                <span class="input-label"  style="color:red" ng-show="activityForm.date.$error.required">Date Required!</span>
              </label>
            </div>
          </div>

          <div class="row" >
            <div class="col">
              <label class="item item-input item-stacked-label">
                <span class="input-label">Quantity ({{currentActivity.unitName}})</span>
                <input type="number" name="quantity" placeholder="{{currentActivity.unitName}}" ng-model="currentActivity.quantity" required min="1" readonly style="text-align: center" ng-click="showNumpad = !showNumpad"/>
                  <numpad ng-show="showNumpad" model="currentActivity.quantity" accept="alert()"></numpad>
                  <span class="input-label"  style="color:red" ng-show="activityForm.quantity.$error.required">Number Required!</span>
              </label>
            </div>
          </div>

          <div class="row">
            <div class="col" style="text-align: right">
              <span style="color:red">{{errorMessage}}</span>
              <button class="button button-balanced" ng-click="addActivity()" ng-disabled="!activityForm.$valid || savingActivity">Add</button>
              <button class="button button-assertive" ng-click="clearActivity()">Clear</button>
            </div>
          </div>
        </form>

        <div class="row">
          <div class="col">
            <h3 class="activity-title">Activity Queue</h3>
          </div>
        </div>
        <div class="row" ng-show="!activtyQueue || activtyQueue.length === 0">
          <div class="col" style="color">
            No Activites Selected
          </div>
        </div>
        <ion-list  show-delete="true" >
          <ion-item ng-repeat="post in activtyQueue" class="item-thumbnail-left activity-queue-item">
            You tracked {{post.quantity}} {{post.unitName}} of {{post.activityName}}
            <ion-delete-button class="ion-minus-circled" ng-click="activtyQueue.splice($index, 1)">
          </ion-item>
        </ion-list>
        <div class="row">
          <div class="col" style="text-align: right">
            <span style="color:red">{{errorMessage}}</span>
            <button class="button button-balanced" ng-show="activtyQueue && activtyQueue.length > 0" ng-click="saveActivities()" ng-disabled="savingActivities">Save</button>
            <button class="button button-assertive" ng-click="cancel()">Cancel</button>
          </div>
        </div>

      </div><!-- activity-select ng-show=addActivityVisible -->


    </div>
    <!--
      This input box should be a fixed element that sits
      on top of the ion-content. Use a directive similar to: http://codepen.io/ionic/pen/hIzFp?editors=001 to show/hide this. Or just fire a CSS transition to animate in/out based on the scrolling direction
     -->
     <!-- <div class="row createPost">
      <form>
        <textarea ng-model="post.content" class="post-box"></textarea>
        <div class="row">
          <div class="col">
            <span class="icon ion-edit"></span>
            <a ng-click="submitPost()" href="javascript:void(0)">Post To Stream</a>
          </div>
          <div class="col">
            <span class="icon ion-android-stopwatch"></span>
            <a>Track Activity</a>
          </div>
        </div>
      </form>
    </div> -->
    <!--<div class="item post" ng-repeat="post in stream.items track by post.streamItemId" data-modal="modal" data-dialog="dialog" data-ng-switch="post.streamItemTypeSlug">-->
      <!--<sprout-event-post data-ng-switch-when="event" class="eventItem"></sprout-event-post>-->
      <!--<sprout-group-post data-ng-switch-when="group" class="groupItem"></sprout-group-post>-->
      <!--<sprout-post data-ng-switch-default=""></sprout-post>-->
    <!--</div>-->

      <div class="item post" ng-repeat="post in stream.items track by post.streamItemId" data-modal="modal" data-dialog="dialog">
          <post post="post" modal-container="streamItemModal" is-wrapped-in-modal="false" view-type="'COMMENTS'"></post>
      </div>


      <!--
          This input box should be a fixed element that sits
          on top of the ion-content. Use a directive similar to: http://codepen.io/ionic/pen/hIzFp?editors=001 to show/hide this. Or just fire a CSS transition to animate in/out based on the scrolling direction
       -->


	  <!--
			The ro-post directive is making a modal for every
			item in the strea. Therefore, you end up with 100's
			of modals on the DOM plus the actual posts. This is bad
			practice. Have the modals be generated in the controller
			and pick the data that is being used to populate the modal.
	   -->
		<!-- <div class="list" data-ng-repeat="item in items">
      	<ro-post ng-model="item" user="user" delete-post="deletePost(item)"></ro-post>
    </div> -->

    <!-- <ion-content>
    ng-class="{true: 'no-header', false: 'has-header'}[createPostVisible]"

    <div class="list card" ng-repeat="item in stream.items">
      <div class="item item-avatar">
        <img ng-src="{{item.avatar}}">
        <h2>{{item.author}}</h2>
        <p>{{item.date | date:'medium'}}</p>
      </div>

      <div class="item item-body">
        <p>{{item.content}}</p>
        <p>
          <a href="#" class="subdued">{{item.likeCount}} Like</a>
          <a href="#" class="subdued">{{item.commentCount}} Comments</a>
        </p>
      </div>

      <div class="item tabs tabs-secondary tabs-icon-left">
        <a class="tab-item" href="#">
          <i class="icon ion-thumbsup"></i>
          Like
        </a>
        <a class="tab-item" href="#">
          <i class="icon ion-chatbox"></i>
          Comment
        </a>
        <a class="tab-item" href="#">
          <i class="icon ion-share"></i>
          Share
        </a>
      </div>
    </div> -->


    <!--
      This makes scrolling slow.
      Handle API updates manually and consider
      tying into ionic.DomUtil.requestAnimationFrame(callback)
      instead i.e, make update calls inside the requestAnimationFrame
      function. Probably don't need to do this though.
    -->
    <ion-infinite-scroll
      on-infinite="performInfiniteScroll()"
      icon="ion-loading-c"
      distance="1%">
    </ion-infinite-scroll>

	</ion-content>
</ion-view>
